import{css as t,LitElement as e,html as r}from"lit";import{property as o,state as n}from"lit/decorators.js";import{classMap as i}from"lit/directives/class-map.js";function a(t,e,r,o){var n,i=arguments.length,a=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(i<3?n(a):i>3?n(e,r,a):n(e,r))||a);return i>3&&a&&Object.defineProperty(e,r,a),a}function c(t,e,r,o){return new(r||(r=Promise))((function(n,i){function a(t){try{l(o.next(t))}catch(t){i(t)}}function c(t){try{l(o.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,c)}l((o=o.apply(t,e||[])).next())}))}function l(t){return null===t?"null":Array.isArray(t)?"array":t.constructor.name.toLowerCase()}function s(t){return t!==Object(t)}function d(t){return!!t&&!!t.nodeType}function u(t){return s(t)||d(t)}function*f(t){const e=[[t,"",[]]];for(;e.length;){const[t,r,o]=e.shift();if(r&&(yield[t,r,o]),!s(t))for(const[n,i]of Object.entries(t))e.push([i,`${r}${r?".":""}${n}`,[...o,r]])}}const h={fromAttribute:t=>t&&t.trim()?JSON.parse(t):void 0,toAttribute:t=>JSON.stringify(t)},p=t=>void 0!==t,b=(t,e)=>e instanceof RegExp?!!t.match(e):function(t,e){const r=t.split("."),o=e.split("."),n=t=>"**"===t;let i=0,a=0;for(;i<r.length;){const t=o[a];if(t===r[i]||"*"===t)a++,i++;else{if(!n(t))return!1;a++,i=r.length-(o.length-a)}}return a===o.length}(t,e),v=t=>{const e=t.querySelector("[part=object]");return!e||![...t.children].includes(e)},g=t=>{const e=t.querySelector("[part=object]");return!(null==e?void 0:e.children)||0===e.children.length},m=(t,e)=>(r,o)=>{const n={};if(t)for(const[,r,i]of f(o.data))b(r,t)&&(n[r]=e,i.forEach((t=>n[t]=e)));return{expanded:n}},y=t=>()=>({highlight:t});function $(t){if(v(t))return t;const e=t.querySelector("[part=object]"),r=null==e?void 0:e.lastElementChild;return r?$(r):t}function j(t,e=t){const r=t.parentElement;if(!r)return t;const o=r.parentElement;return o&&o.parentElement?z(o)?j(o,e):o.nextElementSibling:e}const k=(t,e)=>{var r;const o=e.querySelector(`[data-path="${t}"]`);if(!o)return;const n=o.previousElementSibling||(null===(r=o.parentElement)||void 0===r?void 0:r.parentElement);if(!(n instanceof Element))return;const i=v(n)||((t,e)=>{const r=t.getAttribute("data-path")||"",o=e.getAttribute("data-path")||"";return r.startsWith(o)&&t.parentElement!==e.parentElement})(o,n)?n:$(n);i&&x(i,o)},O=(t,e)=>{const r=e.querySelector(`[data-path="${t}"]`);if(!r)return;const o=w(r);o&&x(o,r)},w=t=>v(t)?z(t)?j(t)||t:t.nextElementSibling:g(t)?j(t):t.querySelector("[part=property]"),x=(t,e)=>{const r=t.querySelector("[part=key]"),o=e.querySelector("[part=key]");o instanceof HTMLSpanElement&&r instanceof HTMLSpanElement&&(r.setAttribute("tabindex","0"),o.setAttribute("tabindex","-1"),r.focus())},z=t=>!t.nextElementSibling,A=t`:host{--background-color:#2a2f3a;--color:#f8f8f2;--string-color:#a3eea0;--number-color:#d19a66;--boolean-color:#4ba7ef;--null-color:#df9cf3;--property-color:#6fb3d2;--preview-color:rgba(222,175,143,0.9);--highlight-color:#7b0000;--font-family:monaco,Consolas,'Lucida Console',monospace;--font-size:1rem;--indent-size:1.5em;--indentguide-size:1px;--indentguide-style:solid;--indentguide-color:#333;--indentguide-color-active:#666;--indentguide:var(--indentguide-size) var(--indentguide-style) var(--indentguide-color);--indentguide-active:var(--indentguide-size) var(--indentguide-style) var(--indentguide-color-active);display:block;background-color:var(--background-color);color:var(--color);font-family:var(--font-family);font-size:var(--font-size)}.preview{color:var(--preview-color)}.null{color:var(--null-color)}.key{color:var(--property-color);display:inline-block}.collapsable:before{display:inline-block;color:var(--color);font-size:.8em;content:'â–¶';line-height:1em;width:1em;height:1em;text-align:center;transition:transform 195ms ease-out;transform:rotate(90deg);color:var(--property-color)}.collapsable.collapsableCollapsed:before{transform:rotate(0)}.collapsable{cursor:pointer;user-select:none}.string{color:var(--string-color)}.number{color:var(--number-color)}.boolean{color:var(--boolean-color)}ul{padding:0;clear:both}ul,li{list-style:none;position:relative}li ul>li{position:relative;margin-left:var(--indent-size);padding-left:0}ul ul:before{content:'';border-left:var(--indentguide);position:absolute;left:calc(0.5em - var(--indentguide-size));top:.3em;bottom:.3em}ul ul:hover:before{border-left:var(--indentguide-active)}mark{background-color:var(--highlight-color)}`;class S extends e{constructor(){super(...arguments),this.state={expanded:{},filtered:{},highlight:null},this.handlePropertyClick=t=>e=>{e.preventDefault(),this.setState(((t,e)=>r=>({expanded:Object.assign(Object.assign({},r.expanded),{[t]:p(e)?!!e:!r.expanded[t]})}))(t))},this.handleKeyDown=t=>{var e,r;if(!this.shadowRoot)return;const o=null===(r=null===(e=this.shadowRoot.activeElement)||void 0===e?void 0:e.parentElement)||void 0===r?void 0:r.getAttribute("data-path");if(o)switch(t.code){case"ArrowUp":t.preventDefault(),k(o,this.shadowRoot);break;case"ArrowDown":t.preventDefault(),O(o,this.shadowRoot);break;case"ArrowLeft":t.preventDefault(),((t,e)=>{const r=e.querySelector(`[data-path="${t}"]`),o=null==r?void 0:r.querySelector("[part=object]");return!(!r||!o)&&[...r.children].includes(o)})(o,this.shadowRoot)?this.setState((t=>e=>({expanded:Object.assign(Object.assign({},e.expanded),{[t]:!1})}))(o)):((t,e)=>{var r;const o=null===(r=e.querySelector(`[data-path="${t}"]`))||void 0===r?void 0:r.querySelector("[part=key]");if(!(o instanceof HTMLElement))return!1;if(o.innerText.includes("."))return o.innerText.split("").filter((t=>"."===t)).length===t.split("").filter((t=>"."===t)).length;return!t.includes(".")})(o,this.shadowRoot)||((t,e)=>{const r=e.querySelector(`[data-path="${t}"]`);r&&r.parentElement&&r.parentElement.parentElement&&x(r.parentElement.parentElement,r)})(o,this.shadowRoot);break;case"ArrowRight":t.preventDefault(),((t,e)=>!e.expanded[t])(o,this.state)?this.setState((t=>e=>({expanded:Object.assign(Object.assign({},e.expanded),{[t]:!0})}))(o)):((t,e)=>{const r=e.querySelector(`[data-path="${t}"]`),o=null==r?void 0:r.querySelector("[part=object]");return!(!r||!o)&&[...r.children].includes(o)&&!g(r)})(o,this.shadowRoot)&&O(o,this.shadowRoot)}}}setState(t){return c(this,void 0,void 0,(function*(){const e=this.state;this.state=Object.assign(Object.assign({},e),t(e,this))}))}connectedCallback(){this.hasAttribute("data")||p(this.data)||this.setAttribute("data",this.innerText),this.addEventListener("keydown",this.handleKeyDown),super.connectedCallback()}expand(t){this.setState(m(t,!0))}expandAll(){this.setState(m("**",!0))}collapseAll(){this.setState(m("**",!1))}collapse(t){this.setState(m(t,!1))}*search(t){for(const[e,r]of f(this.data))u(e)&&String(e).includes(t)&&(this.expand(r),this.updateComplete.then((()=>{const t=this.shadowRoot.querySelector(`[data-path="${r}"]`);t.scrollIntoView({behavior:"smooth",inline:"center",block:"center"}),t.focus()})),this.setState(y(r)),yield{value:e,path:r});this.setState(y(null))}filter(t){var e;this.setState((e=t,(t,r)=>{const o={};if(e)for(const[,t,n]of f(r.data))b(t,e)?(o[t]=!1,n.forEach((t=>o[t]=!1))):o[t]=!0;return{filtered:o}}))}resetFilter(){this.setState((()=>({filtered:{}})))}renderObject(t,e,o){return r`<ul part="object">${Object.keys(t).map(((n,a)=>{const c=t[n],l=e?`${e}.${n}`:n,s=u(c);return r`<li part="property" data-path="${l}" .hidden="${this.state.filtered[l]}"><span part="key" tabindex="${o&&0===a?"0":"-1"}" class="${i({key:n,collapsable:!s,collapsableCollapsed:!this.state.expanded[l]})}" @click="${s?null:this.handlePropertyClick(l)}">${n}: </span>${this.renderNode(c,!1,l)}</li>`}))}</ul>`}renderNode(t,e=!1,r=""){const o=u(t);return!r||this.state.expanded[r]||o?o?this.renderPrimitive(t,r):this.renderObject(t,r,e):this.renderNodePreview(t)}renderNodePreview(t){return r`<span part="preview" class="preview">${function(t,{nodeCount:e=3,maxLength:r=15}={}){const o=Array.isArray(t),n=Object.keys(t),i=n.slice(0,e),a=[],c=t=>{switch(l(t)){case"object":return 0===Object.keys(t).length?"{ }":"{ ... }";case"array":return 0===t.length?"[ ]":"[ ... ]";case"string":return`"${t.substring(0,r)}${t.length>r?"...":""}"`;default:return String(t)}},s=[];for(const e of i){const r=[],n=t[e];o||r.push(`${e}: `),r.push(c(n)),s.push(r.join(""))}n.length>e&&s.push("..."),a.push(s.join(", "));const d=a.join("");return o?`[ ${d} ]`:`{ ${d} }`}(t)}</span>`}renderPrimitive(t,e){const o=this.state.highlight,n=l(t),i=d(t)?t:r`<span part="primitive primitive-${n}" class="${l(t)}">${JSON.stringify(t)}</span>`;return e===o?r`<mark part="highlight">${i}</mark>`:i}render(){const t=this.data;return p(t)?this.renderNode(t,!0):null}}S.styles=[A],a([o({converter:h,type:Object})],S.prototype,"data",void 0),a([n()],S.prototype,"state",void 0);export{S as JsonViewer};
//# sourceMappingURL=JsonViewer.js.map
